<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Scommesse tra Amici</title>
  <style>
    body { font-family: Arial; margin: 20px; }
    input, button { margin: 5px; padding: 5px; }
    table { border-collapse: collapse; margin-top: 15px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
  </style>
</head>
<body>
  <h1>Gestione Scommesse</h1>

  <h3>Aggiungi Partecipante</h3>
  <input id="nome" placeholder="Nome">
  <input id="puntata" type="number" placeholder="Importo scommesso">
  <input id="scelta" placeholder="Pronostico">
  <button onclick="aggiungiPartecipante()">Aggiungi</button>

  <h3>Partecipanti</h3>
  <table id="tabella">
    <tr><th>Nome</th><th>Puntata</th><th>Scelta</th><th>Azioni</th></tr>
  </table>

  <h3>Inserisci Risultato</h3>
  <input id="risultato" placeholder="Risultato vincente">
  <button onclick="calcolaVincite()">Calcola Vincite</button>

  <h3>Risultati</h3>
  <div id="output"></div>

  <script>
    let partecipanti = [];

    function aggiungiPartecipante() {
      let nome = document.getElementById("nome").value;
      let puntata = parseFloat(document.getElementById("puntata").value);
      let scelta = document.getElementById("scelta").value;

      if (nome && !isNaN(puntata) && scelta) {
        partecipanti.push({ nome, puntata, scelta });
        aggiornaTabella();
        document.getElementById("nome").value = "";
        document.getElementById("puntata").value = "";
        document.getElementById("scelta").value = "";
      }
    }

    function rimuoviPartecipante(index) {
      partecipanti.splice(index, 1);
      aggiornaTabella();
    }

    function aggiornaTabella() {
      let tabella = document.getElementById("tabella");
      tabella.innerHTML = "<tr><th>Nome</th><th>Puntata</th><th>Scelta</th><th>Azioni</th></tr>";
      partecipanti.forEach((p, i) => {
        tabella.innerHTML += `<tr>
          <td>${p.nome}</td>
          <td>${p.puntata} €</td>
          <td>${p.scelta}</td>
          <td><button onclick="rimuoviPartecipante(${i})">Rimuovi</button></td>
        </tr>`;
      });
    }

    function arrotonda(valore) {
      let intero = Math.floor(valore);
      let decimale = valore - intero;
      if (decimale >= 0.80) return Math.ceil(valore);
      else return Math.floor(valore);
    }

    function calcolaVincite() {
      let risultato = document.getElementById("risultato").value;
      let vincitori = partecipanti.filter(p => p.scelta === risultato);
      let totale = partecipanti.reduce((acc, p) => acc + p.puntata, 0);
      let commissione = totale * 0.20; // 20%
      let montepremiNetto = totale - commissione;
      let sommaVincitori = vincitori.reduce((acc, p) => acc + p.puntata, 0);

      let output = document.getElementById("output");
      output.innerHTML = `<p>Totale scommesse: ${totale.toFixed(2)} €<br>Montepremi distribuito: ${montepremiNetto.toFixed(2)} €</p>`;

      if (vincitori.length === 0) {
        output.innerHTML += "<p><strong>Nessun vincitore.</strong></p>";
        return;
      }

      vincitori.forEach(p => {
        let quota = p.puntata / sommaVincitori;
        let vincita = quota * montepremiNetto;
        let vincitaArrotondata = arrotonda(vincita);
        output.innerHTML += `<p>${p.nome} ha vinto ${vincitaArrotondata} €</p>`;
      });
    }
  </script>
</body>
</html>